<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Rage Quiz Editor (No Lua VM)</title>
<style>
  body { background: #111; color: #0f0; font-family: monospace; padding: 1rem; }
  textarea { width: 100%; height: 150px; margin-bottom: 1rem; background: #222; border: none; color: #0f0; padding: 1rem; resize: vertical; }
  button { background: darkgreen; border: none; color: white; padding: 1rem 2rem; cursor: pointer; font-size: 1rem; }
  iframe { width: 100%; height: 400px; border: 2px solid #0f0; margin-top: 1rem; }
</style>
</head>
<body>

<h1>Rage Quiz Editor (JS Scripting)</h1>

<h3>Quiz Questions JSON</h3>
<textarea id="questionsInput">[
  {
    "q": "What is 2 + 2?",
    "options": ["3", "4", "Fish", "Window"]
  },
  {
    "q": "Click the WRONG answer!",
    "options": ["Right", "Wrong", "Maybe", "None"]
  }
]</textarea>

<h3>Custom CSS</h3>
<textarea id="cssInput">body {
  font-family: Arial, sans-serif;
  background-color: black;
  color: red;
  text-align: center;
  padding: 2rem;
}

button {
  margin: 0.5rem;
  padding: 1rem 2rem;
  font-size: 1.2rem;
  cursor: pointer;
  background-color: darkred;
  border: none;
  color: white;
}</textarea>

<h3>JS Script to Control Answer Consequences</h3>
<textarea id="scriptInput">// Parameters: questionIndex (0-based), answerIndex (0-based)
// Return: true if correct, false if wrong
function onAnswer(questionIndex, answerIndex) {
  if(questionIndex === 0 && answerIndex === 2) {
    setResult("Correct! Moving on...");
    nextQuestion();
    return true;
  }
  if(questionIndex === 1 && answerIndex === 1) {
    setResult("Correct! Moving on...");
    nextQuestion();
    return true;
  }
  setResult("Wrong! Try again...");
  return false;
}</textarea>

<button onclick="preview()">Preview Quiz</button>

<h2>Preview</h2>
<iframe id="previewFrame" sandbox="allow-scripts allow-same-origin"></iframe>

<script>
  function preview() {
    const questionsText = document.getElementById('questionsInput').value;
    const cssText = document.getElementById('cssInput').value;
    const userScript = document.getElementById('scriptInput').value;

    let questions;
    try {
      questions = JSON.parse(questionsText);
    } catch(e) {
      alert("Invalid JSON for questions!");
      return;
    }

    const iframeDoc = `
      <!DOCTYPE html>
      <html>
      <head>
        <style>${cssText}</style>
      </head>
      <body>
        <h1>Rage Quiz</h1>
        <div id="question"></div>
        <div id="answers"></div>
        <div id="result" style="margin-top:1rem; font-weight:bold;"></div>
        <script>
          let questions = ${JSON.stringify(questions)};
          let currentQ = 0;

          function setResult(msg) {
            document.getElementById('result').textContent = msg;
          }
          function nextQuestion() {
            currentQ++;
            if(currentQ >= questions.length) currentQ = 0;
            loadQuestion();
          }

          // Inject user script
          ${userScript}

          function loadQuestion() {
            const q = questions[currentQ];
            document.getElementById('question').textContent = 'Q' + (currentQ+1) + ': ' + q.q;
            const answersDiv = document.getElementById('answers');
            answersDiv.innerHTML = '';
            setResult('');

            q.options.forEach((opt, i) => {
              let btn = document.createElement('button');
              btn.textContent = opt;
              btn.onclick = () => {
                let correct = false;
                try {
                  correct = onAnswer(currentQ, i);
                } catch(e) {
                  alert("Script error: " + e.message);
                }
                if(!correct) {
                  // fallback if needed
                }
              };
              answersDiv.appendChild(btn);
            });
          }

          loadQuestion();
        <\/script>
      </body>
      </html>
    `;

    const iframe = document.getElementById('previewFrame');
    iframe.srcdoc = iframeDoc;
  }
</script>

</body>
</html>
